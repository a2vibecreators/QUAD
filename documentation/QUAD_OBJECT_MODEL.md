# QUAD Platform - Object Model & Data Architecture

**Date:** December 31, 2025
**Purpose:** Define core objects, relationships, and attribute system

---

## Core Object Hierarchy

```
User (Person who logs in)
  ├── has many → User Roles (QUAD_ADMIN, DOMAIN_ADMIN, DEVELOPER, etc.)
  ├── belongs to many → Domains (can be member of multiple domains)
  └── has allocation % per domain (50% Domain A + 50% Domain B = 100%)

Domain (Workspace/Organization Unit)
  ├── can be → Root Domain (top-level, e.g., "MassMutual")
  ├── can be → Sub-Domain (child, e.g., "MassMutual/Insurance Division")
  ├── has many → Resources (projects, integrations, repos)
  ├── has → Domain Type (Healthcare, Finance, E-commerce, etc.)
  └── has hierarchical path (auto-generated: /massmutual/insurance/claims)

Resource (Thing to develop or manage)
  ├── Types: Git Repository, ITSM Integration, Blueprint, API Project, Web App, Mobile App
  ├── belongs to → Domain
  ├── has many → Attributes (key-value pairs)
  └── Attributes are conditional (based on Resource Type)

Attribute (Configuration property of a Resource)
  ├── Examples: blueprint_url, tech_stack, git_repo_url, backend_framework
  ├── has → is_required (true/false based on Resource Type)
  ├── has → validation_rule (url, enum, string, etc.)
  └── has → applies_to_resource_types (which resource types need this attribute)
```

---

## 1. User Object

```sql
CREATE TABLE users (
  id UUID PRIMARY KEY,
  email VARCHAR(255) UNIQUE,
  name VARCHAR(255),
  created_at TIMESTAMP
);
```

**Properties:**
- One person = one user account
- User can have multiple roles in multiple domains
- Example: Alice can be DOMAIN_ADMIN in "MassMutual/Insurance" and DEVELOPER in "MassMutual/Wealth"

---

## 2. User Roles (in context of a domain)

```sql
CREATE TABLE QUAD_domain_members (
  id UUID PRIMARY KEY,
  user_id UUID REFERENCES users(id),
  domain_id UUID REFERENCES QUAD_domains(id),

  role VARCHAR(50), -- 'QUAD_ADMIN', 'DOMAIN_ADMIN', 'SUBDOMAIN_ADMIN', 'DEVELOPER', 'QA'
  allocation_percentage INT, -- 50 (means 50% of their time to this domain)

  UNIQUE(user_id, domain_id)
);
```

**Example Data:**
| user_id | domain_id | role | allocation_percentage |
|---------|-----------|------|----------------------|
| alice-123 | massmutual-root | QUAD_ADMIN | 100% |
| bob-456 | massmutual-insurance | DOMAIN_ADMIN | 50% |
| bob-456 | massmutual-wealth | DEVELOPER | 50% |

**Business Rules:**
- One user can have different roles in different domains
- Total allocation across all domains ≤ 100%
- Enforced by database trigger: `check_user_total_allocation()`

---

## 3. Domain Object (Can be Root or Sub-Domain)

```sql
CREATE TABLE QUAD_domains (
  id UUID PRIMARY KEY,
  name VARCHAR(255),
  parent_domain_id UUID REFERENCES QUAD_domains(id), -- NULL = root domain
  domain_type VARCHAR(50), -- 'healthcare', 'finance', 'e_commerce', etc.

  -- Auto-generated hierarchical path
  path TEXT, -- '/massmutual/insurance-division/claims'

  created_at TIMESTAMP
);
```

**Hierarchical Structure:**

```
MassMutual (Root Domain)
  ├── domain_type: finance
  ├── path: /massmutual
  ├── parent_domain_id: NULL
  │
  ├─── Insurance Division (Sub-Domain)
  │     ├── domain_type: healthcare
  │     ├── path: /massmutual/insurance-division
  │     ├── parent_domain_id: [massmutual-id]
  │     │
  │     ├─── Life Insurance (Sub-Sub-Domain)
  │     │     ├── path: /massmutual/insurance-division/life-insurance
  │     │     └── parent_domain_id: [insurance-division-id]
  │     │
  │     └─── Claims Processing (Sub-Sub-Domain)
  │           ├── path: /massmutual/insurance-division/claims
  │           └── parent_domain_id: [insurance-division-id]
  │
  └─── Wealth Management (Sub-Domain)
        ├── domain_type: finance
        ├── path: /massmutual/wealth-management
        └── parent_domain_id: [massmutual-id]
```

**Key Points:**
- ✅ YES - Domain CAN be a sub-domain
- Unlimited depth (domain → subdomain → sub-subdomain → ...)
- Path auto-generated by database trigger
- Child domains inherit settings from parent (can override)

---

## 4. Resource Object (Projects, Repos, Integrations)

**Concept:** A **Resource** is anything that needs to be configured within a domain.

```sql
CREATE TABLE QUAD_domain_resources (
  id UUID PRIMARY KEY,
  domain_id UUID REFERENCES QUAD_domains(id),

  resource_type VARCHAR(50) NOT NULL,
  -- 'git_repository', 'web_app_project', 'mobile_app_project', 'api_project',
  -- 'landing_page_project', 'itsm_integration', 'blueprint', 'sso_config'

  resource_name VARCHAR(255),
  resource_status VARCHAR(50), -- 'active', 'inactive', 'pending_setup'

  created_at TIMESTAMP
);
```

**Example Resources in "MassMutual/Insurance/Claims" domain:**

| resource_id | resource_type | resource_name |
|-------------|--------------|---------------|
| res-001 | web_app_project | Claims Dashboard |
| res-002 | git_repository | github.com/massmutual/claims-portal |
| res-003 | blueprint | Figma Claims Dashboard Design |
| res-004 | itsm_integration | Jira Service Management |
| res-005 | mobile_app_project | Claims Mobile App (iOS) |

**Key Insight:** Each resource can have different attributes based on its type.

---

## 5. Attributes (Configuration Properties of Resources)

```sql
CREATE TABLE QUAD_resource_attributes (
  id UUID PRIMARY KEY,
  resource_id UUID REFERENCES QUAD_domain_resources(id),

  attribute_name VARCHAR(50), -- 'blueprint_url', 'tech_stack', 'git_repo_url'
  attribute_value TEXT,

  created_at TIMESTAMP
);
```

**Example: Attributes for resource "Claims Dashboard" (web_app_project):**

| resource_id | attribute_name | attribute_value |
|-------------|----------------|-----------------|
| res-001 | project_type | web_app |
| res-001 | frontend_framework | nextjs |
| res-001 | css_framework | tailwind |
| res-001 | blueprint_url | https://figma.com/... |
| res-001 | git_repo_url | https://github.com/massmutual/claims-portal |
| res-001 | backend_framework | java_spring_boot |
| res-001 | database_type | postgresql |

**Example: Attributes for resource "Jira Integration" (itsm_integration):**

| resource_id | attribute_name | attribute_value |
|-------------|----------------|-----------------|
| res-004 | integration_type | jira_service_management |
| res-004 | jira_url | https://massmutual.atlassian.net |
| res-004 | vault_secret_path | /vaultwarden/massmutual/jira-token |
| res-004 | auto_create_tickets | true |

---

## 6. Attribute Requirements (What's Required Based on Resource Type)

```sql
CREATE TABLE QUAD_resource_attribute_requirements (
  id UUID PRIMARY KEY,

  resource_type VARCHAR(50), -- 'web_app_project', 'api_project', etc.
  attribute_name VARCHAR(50), -- 'blueprint_url', 'tech_stack', etc.

  is_required BOOLEAN, -- true = mandatory, false = optional
  validation_rule VARCHAR(50), -- 'url', 'enum', 'string'
  allowed_values TEXT[], -- For enums: ['nextjs', 'react', 'vue']

  display_order INT,
  help_text TEXT
);
```

**Example Data: Requirements for "web_app_project"**

| resource_type | attribute_name | is_required | validation_rule | allowed_values |
|---------------|----------------|-------------|----------------|----------------|
| web_app_project | project_type | ✅ true | enum | ['web_internal', 'web_external'] |
| web_app_project | frontend_framework | ✅ true | enum | ['nextjs', 'react', 'vue', 'angular'] |
| web_app_project | css_framework | ✅ true | enum | ['tailwind', 'bootstrap', 'mui'] |
| web_app_project | **blueprint_url** | ✅ **true** | url | null |
| web_app_project | git_repo_url | ❌ false | url | null |
| web_app_project | backend_framework | ❌ false | enum | ['nodejs', 'java', 'python'] |
| web_app_project | database_type | ❌ false | enum | ['postgresql', 'mysql', 'mongodb'] |

**Example Data: Requirements for "api_project"**

| resource_type | attribute_name | is_required | validation_rule | allowed_values |
|---------------|----------------|-------------|----------------|----------------|
| api_project | backend_framework | ✅ true | enum | ['nodejs', 'java_spring_boot', 'python_fastapi'] |
| api_project | database_type | ❌ false | enum | ['postgresql', 'mysql', 'mongodb'] |
| api_project | blueprint_url | ❌ **false** | url | null |
| api_project | git_repo_url | ❌ false | url | null |

**Key Insight:**
- `blueprint_url` is **REQUIRED** for `web_app_project`, `mobile_app_project`, `landing_page_project`
- `blueprint_url` is **NOT REQUIRED** for `api_project`
- This is defined in the attribute requirements table, not hardcoded

---

## Complete Example: MassMutual Claims Dashboard

### Object Hierarchy

```
User: Bob Smith (bob@massmutual.com)
  └── Domain Member
      ├── Domain: MassMutual/Insurance Division/Claims
      ├── Role: DOMAIN_ADMIN
      └── Allocation: 50%

Domain: MassMutual/Insurance Division/Claims
  ├── domain_type: healthcare
  ├── path: /massmutual/insurance-division/claims
  ├── parent_domain_id: [insurance-division-id]
  │
  └── Resources:
      │
      ├── Resource #1: Claims Dashboard (web_app_project)
      │   ├── Attributes:
      │   │   ├── project_type: web_internal
      │   │   ├── frontend_framework: nextjs
      │   │   ├── css_framework: tailwind
      │   │   ├── blueprint_url: https://figma.com/claims-dashboard ✅ REQUIRED
      │   │   ├── git_repo_url: https://github.com/mm/claims (optional)
      │   │   ├── backend_framework: java_spring_boot (optional)
      │   │   └── database_type: postgresql (optional)
      │   └── Status: active
      │
      ├── Resource #2: Claims API (api_project)
      │   ├── Attributes:
      │   │   ├── backend_framework: java_spring_boot ✅ REQUIRED
      │   │   ├── database_type: postgresql (optional)
      │   │   └── blueprint_url: (not required for API)
      │   └── Status: active
      │
      ├── Resource #3: Jira Integration (itsm_integration)
      │   ├── Attributes:
      │   │   ├── integration_type: jira_service_management
      │   │   ├── jira_url: https://massmutual.atlassian.net
      │   │   └── vault_secret_path: /vaultwarden/jira-token
      │   └── Status: active
      │
      └── Resource #4: GitHub Webhook (integration_method)
          ├── Attributes:
          │   ├── method_type: webhooks
          │   ├── webhook_url: https://api.quadframe.work/webhooks/push
          │   └── firewall_ips: ['52.1.2.3', '52.1.2.4']
          └── Status: configured
```

---

## Benefits of This Object Model

### 1. **Flexible Attribute System**
- Add new resource types without changing schema
- Add new attributes without migrations
- Different resources can have different attributes

### 2. **Type-Safe Validation**
- Attribute requirements defined in database
- UI auto-generates forms based on requirements
- Backend validates using same rules

### 3. **Hierarchical Domains**
- Unlimited nesting (domain → subdomain → sub-subdomain)
- Inheritance (child domains inherit parent settings)
- Override capability (child can override parent attributes)

### 4. **Multi-Role Users**
- User can be ADMIN in one domain, DEVELOPER in another
- Allocation tracking (50% here + 50% there = 100%)
- Role-based access control per domain

### 5. **Extensibility**
- Add new resource types: `ai_model_config`, `deployment_pipeline`, `monitoring_dashboard`
- Add new attributes: `deployment_region`, `scaling_policy`, `sla_tier`
- No schema changes needed

---

## Summary: Your Questions Answered

**Q1: "User → User Role → User Domain - Can domain be subdomain?"**
- ✅ YES - Domain can be root OR subdomain
- User → `QUAD_domain_members` → Domain (hierarchical)
- Example: Bob is DOMAIN_ADMIN in `/massmutual/insurance/claims` (3 levels deep)

**Q2: "For each domain there are resources linked, for each resource we have attributes?"**
- ✅ EXACTLY RIGHT
- Domain has many Resources (projects, integrations, repos)
- Each Resource has many Attributes (key-value pairs)
- Attributes are type-specific (web app needs blueprint, API doesn't)

**Q3: Object Model Summary**
```
User
  └── Domain Membership (with role + allocation %)
      └── Domain (can be root or subdomain)
          └── Resources (projects, integrations)
              └── Attributes (configuration properties)
```

---

**Next Step:** Apply this object model to redesign the Blueprint Agent flow with proper Resource/Attribute relationships.
